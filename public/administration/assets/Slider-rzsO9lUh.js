import{g as O,a as P,r as p,u as T,_ as k,b as f,j as o,c as D,e as _,s as $,B as R}from"./index-D0zBGyDj.js";import{P as A,a as B,I as F}from"./IconifyIcon-DxrtKAFV.js";import{f as M}from"./csrf-DhkfgJmo.js";import{T as b}from"./Typography-BMrFWdWq.js";import{A as U}from"./Alert-D0WIFuVH.js";import{G as N}from"./Grid-BRaV7QJi.js";import{C as G}from"./Card-BP9RBtBV.js";import"./useSlot-BKua55if.js";function L(t){return O("MuiCardContent",t)}P("MuiCardContent",["root"]);const q=["className","component"],W=t=>{const{classes:r}=t;return _({root:["root"]},L,r)},J=$("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(t,r)=>r.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),H=p.forwardRef(function(r,i){const s=T({props:r,name:"MuiCardContent"}),{className:d,component:u="div"}=s,m=k(s,q),l=f({},s,{component:u}),g=W(l);return o.jsx(J,f({as:u,className:D(g.root,d),ownerState:l,ref:i},m))});function V(t){return O("MuiCardMedia",t)}P("MuiCardMedia",["root","media","img"]);const K=["children","className","component","image","src","style"],Q=t=>{const{classes:r,isMediaComponent:i,isImageComponent:s}=t;return _({root:["root",i&&"media",s&&"img"]},V,r)},X=$("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:i}=t,{isMediaComponent:s,isImageComponent:d}=i;return[r.root,s&&r.media,d&&r.img]}})(({ownerState:t})=>f({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},t.isMediaComponent&&{width:"100%"},t.isImageComponent&&{objectFit:"cover"})),Y=["video","audio","picture","iframe","img"],Z=["picture","img"],ee=p.forwardRef(function(r,i){const s=T({props:r,name:"MuiCardMedia"}),{children:d,className:u,component:m="div",image:l,src:g,style:y}=s,E=k(s,K),C=Y.indexOf(m)!==-1,I=!C&&l?f({backgroundImage:`url("${l}")`},y):y,x=f({},s,{component:m,isMediaComponent:C,isImageComponent:Z.indexOf(m)!==-1}),e=Q(x);return o.jsx(X,f({className:D(e.root,u),as:m,role:!C&&l?"img":void 0,ref:i,style:I,ownerState:x,src:C?l||g:void 0},E,{children:d}))}),de=()=>{const[t,r]=p.useState([]),[i,s]=p.useState(""),[d,u]=p.useState(""),[m,l]=p.useState(null);p.useEffect(()=>{g()},[]);const g=async()=>{try{const a=await(await fetch("/api/slider")).json(),n=[a.find(h=>h.order===0)||null,a.find(h=>h.order===1)||null,a.find(h=>h.order===2)||null];r(n)}catch(e){console.error("Error loading images:",e),s("Erreur lors du chargement des images")}},y=async(e,a)=>{if(a){l(e),s(""),u("");try{let n;if(!(a.type.startsWith("image/")&&a.size<1048576)){const c=`/api/upload?filename=${encodeURIComponent(a.name)}`;n=await M(c,{method:"POST",headers:{"Content-Type":"application/octet-stream","x-file-name":encodeURIComponent(a.name)},body:a})}else{const c=new FormData;c.append("file",a),n=await M("/api/upload",{method:"POST",body:c})}if(!n.ok){const c=await n.json().catch(()=>({})),v=c?.message||c?.error||"Erreur lors de l'upload de l'image";throw new Error(v)}const{url:z}=await n.json(),j=t[e],S={title:j?.title||"",subtitle:j?.subtitle||"",image:z,order:e,isActive:!0};let w;if(j?.id?w=await M(`/api/slider/${j.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)}):w=await M("/api/slider",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)}),!w.ok){const c=await w.json().catch(()=>({})),v=c?.error||c?.message||c?.details||"Erreur lors de la sauvegarde";throw new Error(typeof v=="string"?v:"Erreur lors de la sauvegarde")}u("Image mise à jour avec succès !"),g()}catch(n){console.error("Error uploading image:",n),s(n instanceof Error?n.message:"Erreur lors de l'upload de l'image")}finally{l(null)}}},E=(e,a)=>{const n=a.target.files?.[0];n&&y(e,n)},C="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200' viewBox='0 0 400 200'%3E%3Crect fill='%23e5e7eb' width='400' height='200'/%3E%3Ctext fill='%239ca3af' x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-size='18'%3ECliquez pour ajouter%3C/text%3E%3C/svg%3E",I=e=>e?.image?e.image:C,x=e=>e?.image?{}:{border:"2px dashed #ccc",backgroundColor:"#f5f5f5"};return o.jsx(R,{children:o.jsxs(A,{sx:{p:3},children:[o.jsx(b,{variant:"h5",gutterBottom:!0,children:"Gestion du Slider"}),o.jsx(b,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Cliquez sur une image pour la remplacer. Le slider affiche 3 images en rotation."}),i&&o.jsx(U,{severity:"error",sx:{mb:2},onClose:()=>s(""),children:i}),d&&o.jsx(U,{severity:"success",sx:{mb:2},onClose:()=>u(""),children:d}),o.jsx(N,{container:!0,spacing:3,children:[0,1,2].map(e=>o.jsx(N,{item:!0,xs:12,children:o.jsxs(G,{sx:{cursor:"pointer",transition:"transform 0.2s",display:"flex",flexDirection:"row","&:hover":{transform:"scale(1.02)"},...x(t[e]||null)},children:[o.jsx("input",{type:"file",accept:"image/*",id:`file-input-${e}`,style:{display:"none"},onChange:a=>E(e,a)}),o.jsxs("label",{htmlFor:`file-input-${e}`,style:{cursor:"pointer",display:"flex",width:"100%"},children:[o.jsx(ee,{component:"img",sx:{width:200,height:120,objectFit:"cover",opacity:m===e?.5:1},image:I(t[e]||null),alt:`Slider ${e+1}`}),o.jsxs(H,{sx:{flex:1},children:[o.jsxs(R,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[o.jsxs(b,{variant:"h6",children:["Image ",e+1]}),o.jsx(B,{size:"small",color:"primary",children:o.jsx(F,{icon:m===e?"eos-icons:loading":"material-symbols:upload"})})]}),!t[e]?.image&&o.jsx(b,{variant:"caption",color:"text.secondary",children:"Cliquez pour ajouter une image"})]})]})]})},e))})]})})};export{de as default};
