import{r as n,j as r,B as c,S as x,C}from"./index-D0zBGyDj.js";import{I as y,a as S}from"./IconifyIcon-DxrtKAFV.js";import{f as b}from"./csrf-DhkfgJmo.js";import{T as o}from"./Typography-BMrFWdWq.js";import{A as j}from"./Alert-D0WIFuVH.js";import{C as E}from"./Card-BP9RBtBV.js";import{A as W}from"./Avatar-CTSRc17x.js";import"./useSlot-BKua55if.js";const P=()=>{const[m,l]=n.useState([]),[v,f]=n.useState(!0),[g,s]=n.useState(""),[w,d]=n.useState("");n.useEffect(()=>{u()},[]);const u=async()=>{try{f(!0);const e=await fetch("/api/telegram/admins",{credentials:"include"}),t=await e.json();Array.isArray(t)?l(t):(l([]),t?.error&&!e.ok&&s(t.error))}catch(e){console.error("Error fetching admins:",e),s("Erreur lors du chargement des administrateurs"),l([])}finally{f(!1)}},A=async e=>{const a=e.id==="current-user"?"Vous allez perdre vos droits administrateur. Vous serez redirigé. Continuer ?":"Êtes-vous sûr de vouloir supprimer cet administrateur ?";if(confirm(a))try{const i=typeof window<"u"?window.location.origin:"",p=await b(`${i}/api/telegram/admins/${encodeURIComponent(e.id)}`,{method:"DELETE",credentials:"include"}),h=await p.json().catch(()=>({}));if(p.ok){if(d(h.message||"Administrateur supprimé avec succès"),h.redirect){window.location.href="/";return}u()}else s(h.error||`Erreur lors de la suppression (${p.status})`)}catch(i){console.error("Delete error:",i),s("Erreur lors de la suppression")}},I=async e=>{try{const t=typeof window<"u"?window.location.origin:"",a=await b(`${t}/api/telegram/admins/${encodeURIComponent(e.id)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!e.isActive}),credentials:"include"});if(a.ok)d(`Administrateur ${e.isActive?"désactivé":"activé"} avec succès`),u();else{const i=await a.json();s(i.error||"Erreur lors de la modification")}}catch(t){console.error("Toggle error:",t),s("Erreur lors de la modification")}};return r.jsxs(c,{children:[r.jsx(x,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:4,children:r.jsx(o,{variant:"h5",color:"common.white",children:"Administrateurs"})}),g&&r.jsx(j,{severity:"error",sx:{mb:2},onClose:()=>s(""),children:g}),w&&r.jsx(j,{severity:"success",sx:{mb:2},onClose:()=>d(""),children:w}),r.jsx(x,{spacing:1.5,children:v?r.jsx(c,{sx:{display:"flex",justifyContent:"center",p:4},children:r.jsx(C,{})}):m.length===0?r.jsx(o,{color:"text.disabled",align:"center",children:"Aucun administrateur"}):m.map(e=>r.jsxs(E,{elevation:0,sx:{p:1,display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",borderRadius:2,bgcolor:"background.paper",boxShadow:"0px 2px 5px rgba(0, 0, 0, 0.05)",transition:"all 0.2s ease",width:"100%","&:hover":{transform:"translateY(-1px)",boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.08)"}},children:[r.jsx(W,{src:e.telegramPhoto?e.telegramPhoto:e.telegramId?`/api/telegram/user-photo?telegramId=${e.telegramId}`:void 0,sx:{width:56,height:56,mr:2,bgcolor:"action.hover"},children:r.jsx(y,{icon:"mdi:account",width:28,color:"text.secondary"})}),r.jsx(c,{sx:{flexGrow:1,minWidth:0,mx:2,display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden"},children:r.jsxs(c,{sx:{minWidth:0,mr:2,flex:1,display:"flex",alignItems:"center",gap:1.5,flexWrap:"wrap"},children:[e.username&&r.jsxs(o,{variant:"subtitle2",fontWeight:600,sx:{fontSize:"0.9rem",color:"text.primary"},children:["@",e.username]}),e.telegramId&&r.jsx(o,{variant:"caption",fontFamily:"monospace",color:"text.secondary",sx:{fontSize:"0.8rem",bgcolor:"action.hover",px:1,py:.5,borderRadius:1},children:e.telegramId}),!e.username&&!e.telegramId&&r.jsx(o,{variant:"subtitle2",color:"text.disabled",children:"—"}),r.jsx(o,{variant:"caption",sx:{fontSize:"0.75rem",bgcolor:e.isActive?"success.lighter":"action.disabledBackground",color:e.isActive?"success.dark":"text.disabled",px:1,py:.5,borderRadius:1,fontWeight:"bold",cursor:e.id.startsWith("config-")||e.id==="current-user"?"default":"pointer","&:hover":e.id.startsWith("config-")||e.id==="current-user"?{}:{opacity:.9}},onClick:()=>!e.id.startsWith("config-")&&e.id!=="current-user"&&I(e),children:e.isActive?"ACTIF":"INACTIF"})]})}),r.jsx(x,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"fit-content"},children:r.jsx(S,{size:"small",onClick:()=>A(e),sx:{color:"error.main",bgcolor:"error.lighter",width:32,height:32,"&:hover":{bgcolor:"error.light",color:"white"}},children:r.jsx(y,{icon:"material-symbols:delete-outline",width:18})})})]},e.id))})]})};export{P as default};
