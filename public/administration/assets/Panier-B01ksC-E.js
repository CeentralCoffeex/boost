import{r as i,j as e,B as m,S as k}from"./index-D0zBGyDj.js";import{P as T,I as g}from"./IconifyIcon-DxrtKAFV.js";import{f as E}from"./csrf-DhkfgJmo.js";import{T as s}from"./Typography-BMrFWdWq.js";import{A as y}from"./Alert-D0WIFuVH.js";import{G as n}from"./Grid-BRaV7QJi.js";import{F as I,S as L}from"./Switch-D46eJ3ud.js";import{T as v}from"./TextField-Cg6oPGF_.js";import{B as P}from"./Button-Ch97SugN.js";import"./useSlot-BKua55if.js";import"./Menu-B5xWsZiJ.js";const _=()=>{const[r,l]=i.useState("telegram"),[d,p]=i.useState(""),[h,x]=i.useState(""),[u,f]=i.useState(!1),[b,a]=i.useState(""),[j,c]=i.useState("");i.useEffect(()=>{S()},[]);const S=async()=>{try{const o=await fetch("/api/order-telegram",{credentials:"include"});if(o.ok){const t=await o.json();p(t.orderTelegramUsername||""),l(t.orderPlatform||"telegram"),x(t.orderSignalLink||"")}}catch{a("Erreur lors du chargement")}},C=async()=>{f(!0),a(""),c("");try{const o={orderPlatform:r,orderTelegramUsername:d.replace(/^@/,"").trim()||"savpizz13"};r==="signal"&&(o.orderSignalLink=h.trim());const t=await E("/api/order-telegram",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(t.ok)c("Configuration enregistrée"),setTimeout(()=>c(""),3e3);else{const w=await t.json().catch(()=>({}));a(w?.error||"Erreur lors de l'enregistrement")}}catch(o){console.error(o),a("Erreur lors de l'enregistrement")}finally{f(!1)}};return e.jsxs(m,{children:[e.jsx(s,{variant:"h4",color:"common.white",mb:4,children:"Panier & Commandes"}),b&&e.jsx(y,{severity:"error",sx:{mb:2},onClose:()=>a(""),children:b}),j&&e.jsx(y,{severity:"success",sx:{mb:2},onClose:()=>c(""),children:j}),e.jsx(T,{sx:{p:{xs:3,sm:4}},children:e.jsxs(n,{container:!0,spacing:4,children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",color:"common.white",mb:2,children:"Plateforme de redirection (Meet-up & Livraison)"}),e.jsx(s,{variant:"body2",color:"grey.400",mb:2,children:"Choisissez vers quelle plateforme les clients seront redirigés lors de la finalisation de leur commande."}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(I,{control:e.jsx(L,{checked:r==="telegram",onChange:(o,t)=>l(t?"telegram":"signal"),color:"primary"}),label:""}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1.5,px:2,py:1,borderRadius:2,bgcolor:r==="telegram"?"rgba(0, 136, 204, 0.2)":"rgba(255,255,255,0.05)",border:r==="telegram"?"2px solid #0088cc":"1px solid rgba(255,255,255,0.1)",cursor:"pointer",minWidth:140,justifyContent:"center"},onClick:()=>l("telegram"),children:[e.jsx(g,{icon:"mdi:telegram",width:28,height:28,color:r==="telegram"?"#0088cc":void 0}),e.jsx(s,{color:r==="telegram"?"primary.main":"grey.400",fontWeight:600,children:"Telegram"})]}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",gap:1.5,px:2,py:1,borderRadius:2,bgcolor:r==="signal"?"rgba(58, 134, 255, 0.2)":"rgba(255,255,255,0.05)",border:r==="signal"?"2px solid #3a86ff":"1px solid rgba(255,255,255,0.1)",cursor:"pointer",minWidth:140,justifyContent:"center"},onClick:()=>l("signal"),children:[e.jsx(g,{icon:"simple-icons:signal",width:28,height:28,color:r==="signal"?"#3a86ff":void 0}),e.jsx(s,{color:r==="signal"?"#3a86ff":"grey.400",fontWeight:600,children:"Signal"})]})]})]}),r==="telegram"&&e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle1",color:"common.white",mb:1,children:"@ Telegram pour les commandes"}),e.jsx(v,{fullWidth:!0,size:"small",value:d,onChange:o=>p(o.target.value),placeholder:"savpizz13",InputProps:{startAdornment:e.jsx(s,{sx:{mr:1,color:"grey.400"},children:"@"})},sx:{"& .MuiOutlinedInput-root":{bgcolor:"rgba(255,255,255,0.05)",color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.2)"}}}}),e.jsxs(s,{variant:"caption",color:"grey.500",sx:{mt:.5,display:"block"},children:["Le panier redirigera vers t.me/@",d||"..."," avec la commande pré-remplie"]})]}),r==="signal"&&e.jsxs(n,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"subtitle1",color:"common.white",mb:1,children:"Lien Signal pour le panier"}),e.jsx(v,{fullWidth:!0,size:"small",value:h,onChange:o=>x(o.target.value),placeholder:"https://signal.me/#eu/VOTRE_LIEN",sx:{"& .MuiOutlinedInput-root":{bgcolor:"rgba(255,255,255,0.05)",color:"white","& fieldset":{borderColor:"rgba(255,255,255,0.2)"}}}}),e.jsx(s,{variant:"caption",color:"grey.500",sx:{mt:.5,display:"block"},children:"Les clients seront redirigés vers ce lien Signal avec la commande copiée dans le presse-papier"})]}),e.jsx(n,{item:!0,xs:12,children:e.jsx(k,{direction:"row",spacing:2,justifyContent:"flex-end",children:e.jsx(P,{variant:"contained",onClick:C,disabled:u,startIcon:e.jsx(g,{icon:"mdi:content-save",width:20}),sx:{bgcolor:"primary.main",color:"common.black",minWidth:150,"&:hover":{bgcolor:"primary.dark"}},children:u?"Enregistrement...":"Enregistrer"})})})]})})]})};export{_ as default};
