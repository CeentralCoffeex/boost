import{b as m,r as u,_ as R,j as r,c as E,v as $,d as v,w as P,e as T,x as I,g as L,u as z,s as G,q as D,B as p,C as M,S as g}from"./index-D0zBGyDj.js";import{I as b,a as y}from"./IconifyIcon-DxrtKAFV.js";import{f as N}from"./csrf-DhkfgJmo.js";import{T as f}from"./Typography-BMrFWdWq.js";import{B}from"./Button-Ch97SugN.js";import{C as U}from"./Card-BP9RBtBV.js";const _=["className","component","disableGutters","fixed","maxWidth","classes"],F=I(),O=$("div",{name:"MuiContainer",slot:"Root",overridesResolver:(o,i)=>{const{ownerState:n}=o;return[i.root,i[`maxWidth${v(String(n.maxWidth))}`],n.fixed&&i.fixed,n.disableGutters&&i.disableGutters]}}),q=o=>P({props:o,name:"MuiContainer",defaultTheme:F}),H=(o,i)=>{const n=c=>L(i,c),{classes:h,fixed:l,disableGutters:a,maxWidth:t}=o,s={root:["root",t&&`maxWidth${v(String(t))}`,l&&"fixed",a&&"disableGutters"]};return T(s,n,h)};function Y(o={}){const{createStyledComponent:i=O,useThemeProps:n=q,componentName:h="MuiContainer"}=o,l=i(({theme:t,ownerState:s})=>m({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!s.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}}),({theme:t,ownerState:s})=>s.fixed&&Object.keys(t.breakpoints.values).reduce((c,e)=>{const d=e,x=t.breakpoints.values[d];return x!==0&&(c[t.breakpoints.up(d)]={maxWidth:`${x}${t.breakpoints.unit}`}),c},{}),({theme:t,ownerState:s})=>m({},s.maxWidth==="xs"&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},s.maxWidth&&s.maxWidth!=="xs"&&{[t.breakpoints.up(s.maxWidth)]:{maxWidth:`${t.breakpoints.values[s.maxWidth]}${t.breakpoints.unit}`}}));return u.forwardRef(function(s,c){const e=n(s),{className:d,component:x="div",disableGutters:w=!1,fixed:C=!1,maxWidth:W="lg"}=e,S=R(e,_),j=m({},e,{component:x,disableGutters:w,fixed:C,maxWidth:W}),k=H(j,h);return r.jsx(l,m({as:x,ownerState:j,className:E(k.root,d),ref:c},S))})}const A=Y({createStyledComponent:G("div",{name:"MuiContainer",slot:"Root",overridesResolver:(o,i)=>{const{ownerState:n}=o;return[i.root,i[`maxWidth${v(String(n.maxWidth))}`],n.fixed&&i.fixed,n.disableGutters&&i.disableGutters]}}),useThemeProps:o=>z({props:o,name:"MuiContainer"})}),J=({image:o,videoUrl:i,alt:n})=>{const[h,l]=u.useState(null);return u.useEffect(()=>{if(!o&&i){const a=document.createElement("video");a.src=i,a.crossOrigin="anonymous",a.currentTime=1,a.muted=!0;const t=()=>{const s=document.createElement("canvas");s.width=a.videoWidth,s.height=a.videoHeight;const c=s.getContext("2d");c&&(c.drawImage(a,0,0,s.width,s.height),l(s.toDataURL())),a.remove()};return a.addEventListener("loadeddata",t),a.load(),()=>{a.removeEventListener("loadeddata",t),a.remove()}}},[o,i]),r.jsx(p,{component:"img",src:o||h||"/placeholder.png",alt:n,sx:{width:60,height:60,borderRadius:2,objectFit:"cover",mr:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}})};function K(){const o=D(),[i,n]=u.useState([]),[h,l]=u.useState(!0),a=async()=>{l(!0);try{const e=await fetch("/api/products",{credentials:"include"});if(e.ok){const d=await e.json();n(d)}}catch(e){console.error("Failed to fetch products",e)}finally{l(!1)}};u.useEffect(()=>{a()},[]);const t=async e=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce produit ?"))try{const d=await N(`/api/products/${e}`,{method:"DELETE",credentials:"include"});if(d.ok)a();else{const x=await d.json().catch(()=>({}));alert(x?.error||x?.message||"Erreur lors de la suppression")}}catch(d){console.error("Delete failed",d),alert("Erreur lors de la suppression du produit")}},s=e=>{e?.id&&o(`/product/edit/${e.id}`)},c=()=>{o("/product/new")};return h?r.jsx(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:r.jsx(M,{})}):r.jsxs(A,{maxWidth:"xl",sx:{py:2},children:[r.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,sx:{gap:2},children:[r.jsx(p,{children:r.jsx(f,{variant:"h6",fontWeight:"bold",sx:{fontSize:"1rem"},children:"Produits"})}),r.jsx(B,{variant:"contained",size:"small",startIcon:r.jsx(b,{icon:"fluent:add-24-filled",width:16}),onClick:c,sx:{borderRadius:2,px:1.5,py:.5,boxShadow:"none",fontSize:"0.75rem",whiteSpace:"nowrap",height:32},children:"Nouveau"})]}),r.jsx(g,{spacing:1.5,children:i.map(e=>r.jsxs(U,{elevation:0,sx:{p:1,display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",borderRadius:2,bgcolor:"background.paper",boxShadow:"0px 2px 5px rgba(0, 0, 0, 0.05)",transition:"all 0.2s ease",width:"100%","&:hover":{transform:"translateY(-1px)",boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.08)"}},children:[r.jsx(J,{image:e.image,videoUrl:e.videoUrl,alt:e.title}),r.jsxs(p,{sx:{flexGrow:1,minWidth:0,mx:2,display:"flex",alignItems:"center",justifyContent:"space-between",overflow:"hidden"},children:[r.jsxs(p,{sx:{minWidth:0,mr:2,flex:1,display:"flex",alignItems:"center",gap:2},children:[r.jsx(f,{variant:"subtitle2",fontWeight:700,noWrap:!0,title:e.title,sx:{fontSize:"0.9rem",mb:0,color:"text.primary"},children:e.title}),r.jsx(f,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{fontSize:"0.75rem",bgcolor:"action.hover",px:1,py:.5,borderRadius:1},children:e.category?e.category.parent?`${e.category.parent.name} › ${e.category.name}`:e.category.name:e.tag||e.section||"Sans catégorie"})]}),r.jsx(f,{variant:"subtitle2",fontWeight:700,color:"primary.main",sx:{fontSize:"0.9rem",whiteSpace:"nowrap",mr:2},children:e.price?`${e.price} €`:""})]}),r.jsxs(g,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:"fit-content"},children:[r.jsx(y,{onClick:()=>s(e),size:"small",sx:{bgcolor:"action.hover",width:32,height:32,"&:hover":{bgcolor:"primary.lighter",color:"primary.main"}},children:r.jsx(b,{icon:"material-symbols:edit-outline",width:18,height:18})}),r.jsx(y,{size:"small",onClick:()=>t(e.id),sx:{color:"error.main",bgcolor:"error.lighter",width:32,height:32,"&:hover":{bgcolor:"error.light",color:"white"}},children:r.jsx(b,{icon:"material-symbols:delete-outline",width:18})})]})]},e.id))})]})}const re=()=>r.jsx(p,{sx:{pb:3},children:r.jsx(K,{})});export{re as default};
